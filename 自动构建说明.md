# ✅ 自动构建配置完成

## 🎉 已完成配置

现在每次启动开发服务器时，**shared包会自动构建**，你不需要手动运行构建命令了！

## 📋 配置详情

### ✅ 各端已添加自动构建

通过 npm/pnpm 的 `pre` 钩子，在每个端的 dev 命令前自动构建 shared 包：

#### Backend (Next.js)
```bash
pnpm dev             # 自动构建shared，然后启动
```

#### Desktop (Electron)
```bash
pnpm electron:dev    # 自动构建shared，然后启动
```

#### Mobile (React Native)
```bash
pnpm dev             # 自动构建shared，然后启动
pnpm start           # 自动构建shared，然后启动
```

#### Miniapp (Taro)
```bash
pnpm dev             # 自动构建shared，然后启动
pnpm dev:weapp       # 自动构建shared，然后启动
```

## 🚀 使用方法

### 方式1: 在各端目录直接启动（推荐）

```bash
# Backend
cd packages/backend
pnpm dev

# Desktop
cd packages/desktop
pnpm electron:dev

# Mobile
cd packages/mobile
pnpm dev

# Miniapp
cd packages/miniapp
pnpm dev
```

### 方式2: 在根目录启动

```bash
# 启动backend
pnpm dev:backend

# 启动desktop
pnpm dev:desktop

# 启动mobile
pnpm dev:mobile

# 启动miniapp
pnpm dev:miniapp
```

## ⚡ 工作流程

现在的开发流程变得非常简单：

### 1️⃣ 修改配置
编辑 `packages/shared/src/constants/index.ts`

### 2️⃣ 重启应用
停止当前应用（Ctrl+C），然后重新启动：
```bash
pnpm electron:dev  # 或其他端的dev命令
```

**就这样！shared包会自动重新构建，配置立即生效！** ✨

## 🔍 技术细节

### npm/pnpm 的 pre 钩子
npm和pnpm都支持在运行某个命令前自动执行 `pre<命令名>` 脚本。

例如：
```json
{
  "scripts": {
    "predev": "cd ../shared && pnpm build",
    "dev": "next dev"
  }
}
```

当你运行 `pnpm dev` 时：
1. 首先执行 `predev` → 构建 shared 包
2. 然后执行 `dev` → 启动开发服务器

## 📝 注意事项

### ⚠️ 首次启动会慢一点
第一次启动时，会先构建 shared 包（大约1-2秒），然后才启动应用。这是正常的。

### ✅ 热更新
- **修改shared配置**：需要重启应用
- **修改组件代码**：支持热更新，不需要重启

### 🔄 手动构建（一般不需要）
如果你想手动构建 shared 包：
```bash
cd packages/shared
pnpm build
```

## 🎯 对比

### 之前的流程 ❌
```bash
# 修改配置
vim packages/shared/src/constants/index.ts

# 手动构建shared包
cd packages/shared
pnpm build

# 重启应用
cd packages/desktop
pnpm electron:dev
```

### 现在的流程 ✅
```bash
# 修改配置
vim packages/shared/src/constants/index.ts

# 重启应用（自动构建）
cd packages/desktop
pnpm electron:dev
```

**少了一步，更简单！** 🎉

## 💡 最佳实践

1. **修改配置后直接重启**，不需要手动构建
2. **使用各端的 dev 命令**，它们会自动处理构建
3. **如果配置没生效**，检查是否正确重启了应用

## 🎓 扩展

如果你想监听 shared 包的变化并自动重新构建（实时热更新），可以：

```bash
# 在一个终端
cd packages/shared
pnpm dev  # 监听模式

# 在另一个终端
cd packages/desktop
pnpm electron:dev
```

这样修改配置后会自动重新编译，但仍需要手动刷新应用。

---

✨ **现在开发体验更流畅了！**

