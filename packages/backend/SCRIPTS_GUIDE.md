# ğŸ“œ Backend è„šæœ¬å‘½ä»¤æŒ‡å—

## ğŸš€ å¼€å‘å‘½ä»¤

### å¯åŠ¨åå°ç®¡ç†ç³»ç»Ÿ
```bash
pnpm dev
```
- å¯åŠ¨ Next.js å¼€å‘æœåŠ¡å™¨
- è®¿é—®ï¼š`http://localhost:3000`
- ç®¡ç†åå°ï¼š`http://localhost:3000/admin`
- çƒ­æ›´æ–°è‡ªåŠ¨åˆ·æ–°

### å¯åŠ¨ç§»åŠ¨ç«¯
```bash
pnpm mobile:dev
```
- ä» backend ç›®å½•å¯åŠ¨ç§»åŠ¨ç«¯å¼€å‘æœåŠ¡å™¨
- ç­‰åŒäºåœ¨ `packages/mobile` è¿è¡Œ `pnpm start`
- ä¼šæ‰“å¼€ Expo å¼€å‘å·¥å…·

### å¯åŠ¨å°ç¨‹åº
```bash
pnpm miniapp:dev
```
- ä» backend ç›®å½•å¯åŠ¨å°ç¨‹åºå¼€å‘
- ç­‰åŒäºåœ¨ `packages/miniapp` è¿è¡Œ `pnpm dev`
- ç¼–è¯‘åˆ° `packages/miniapp/dist`ï¼Œä½¿ç”¨å¾®ä¿¡å¼€å‘è€…å·¥å…·æ‰“å¼€

## ğŸ—„ï¸ æ•°æ®åº“å‘½ä»¤

### å¼€å‘ç¯å¢ƒæ•°æ®åº“

#### ç”Ÿæˆè¿ç§»æ–‡ä»¶
```bash
pnpm db:dev:generate
```
- ä½¿ç”¨ `.env.local` é…ç½®
- æ ¹æ® schema å˜æ›´ç”Ÿæˆè¿ç§» SQL
- æ–‡ä»¶ä¿å­˜åœ¨ `drizzle/migrations/`

#### æ¨é€åˆ°æ•°æ®åº“
```bash
pnpm db:dev:push
```
- ä½¿ç”¨ `.env.local` é…ç½®
- ç›´æ¥å°† schema æ›´æ”¹æ¨é€åˆ°å¼€å‘æ•°æ®åº“
- âš ï¸ ä¼šè¦†ç›–ç°æœ‰è¡¨ç»“æ„

### ç”Ÿäº§ç¯å¢ƒæ•°æ®åº“

#### ç”Ÿæˆè¿ç§»æ–‡ä»¶
```bash
pnpm db:prod:generate
```
- ä½¿ç”¨ `.env.production` é…ç½®
- ç”Ÿæˆç”Ÿäº§ç¯å¢ƒè¿ç§»æ–‡ä»¶
- å»ºè®®åœ¨éƒ¨ç½²å‰ç”Ÿæˆ

#### æ¨é€åˆ°æ•°æ®åº“
```bash
pnpm db:prod:push
```
- ä½¿ç”¨ `.env.production` é…ç½®
- å°† schema æ¨é€åˆ°ç”Ÿäº§æ•°æ®åº“
- âš ï¸ è°¨æ…ä½¿ç”¨ï¼Œå¯èƒ½å¯¼è‡´æ•°æ®ä¸¢å¤±

## ğŸ“¦ æ„å»ºå’Œéƒ¨ç½²

### æ„å»ºç”Ÿäº§ç‰ˆæœ¬
```bash
pnpm build
```
- æ„å»ºä¼˜åŒ–çš„ç”Ÿäº§ç‰ˆæœ¬
- è¾“å‡ºåˆ° `.next` ç›®å½•

### å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨
```bash
pnpm start
```
- å¯åŠ¨ç”Ÿäº§æ¨¡å¼æœåŠ¡å™¨
- éœ€è¦å…ˆè¿è¡Œ `pnpm build`

## ğŸ” ä»£ç è´¨é‡

### ä»£ç æ£€æŸ¥
```bash
pnpm lint
```
- è¿è¡Œ ESLint æ£€æŸ¥ä»£ç è´¨é‡
- è‡ªåŠ¨æ£€æµ‹ä»£ç è§„èŒƒé—®é¢˜

## ğŸ“‹ å¸¸ç”¨å·¥ä½œæµ

### æœ¬åœ°å¼€å‘æµç¨‹

1. **é¦–æ¬¡å¯åŠ¨**
   ```bash
   # 1. ç”Ÿæˆæ•°æ®åº“è¡¨
   pnpm db:dev:generate
   pnpm db:dev:push
   
   # 2. å¯åŠ¨åå°ç³»ç»Ÿ
   pnpm dev
   
   # 3. å¦å¼€ç»ˆç«¯ï¼Œå¯åŠ¨ç§»åŠ¨ç«¯
   pnpm mobile:dev
   
   # 4. æˆ–å¯åŠ¨å°ç¨‹åºï¼ˆå†å¼€ä¸€ä¸ªç»ˆç«¯ï¼‰
   pnpm miniapp:dev
   ```

2. **ä¿®æ”¹æ•°æ®åº“ Schema**
   ```bash
   # 1. ä¿®æ”¹ drizzle/migrations/schema.ts
   
   # 2. ç”Ÿæˆè¿ç§»
   pnpm db:dev:generate
   
   # 3. åº”ç”¨åˆ°æ•°æ®åº“
   pnpm db:dev:push
   
   # 4. é‡å¯æœåŠ¡
   pnpm dev
   ```

3. **éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ**
   ```bash
   # 1. ç”Ÿæˆç”Ÿäº§è¿ç§»
   pnpm db:prod:generate
   
   # 2. æ„å»ºé¡¹ç›®
   pnpm build
   
   # 3. åº”ç”¨æ•°æ®åº“è¿ç§»
   pnpm db:prod:push
   
   # 4. å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨
   pnpm start
   ```

## ğŸ”§ ç¯å¢ƒé…ç½®æ–‡ä»¶

| ç¯å¢ƒ | é…ç½®æ–‡ä»¶ | æ•°æ®åº“å‘½ä»¤å‰ç¼€ |
|------|---------|---------------|
| **å¼€å‘ç¯å¢ƒ** | `.env.local` | `db:dev:*` |
| **ç”Ÿäº§ç¯å¢ƒ** | `.env.production` | `db:prod:*` |

## âš ï¸ æ³¨æ„äº‹é¡¹

### æ•°æ®åº“æ“ä½œ
- âœ… **å¼€å‘ç¯å¢ƒ** å¯ä»¥éšæ„ä½¿ç”¨ `push`
- âš ï¸ **ç”Ÿäº§ç¯å¢ƒ** åŠ¡å¿…å…ˆ `generate` æ£€æŸ¥è¿ç§»æ–‡ä»¶
- âŒ ç”Ÿäº§ç¯å¢ƒé¿å…ç›´æ¥ `push`ï¼Œä¼˜å…ˆä½¿ç”¨ `migrate`

### ç§»åŠ¨ç«¯å¼€å‘
- ç¡®ä¿å·²å®‰è£… Expo CLIï¼š`npm install -g @expo/cli`
- é¦–æ¬¡å¯åŠ¨å¯èƒ½éœ€è¦å®‰è£…ä¾èµ–
- éœ€è¦ Expo Go åº”ç”¨ï¼ˆiOS/Androidï¼‰æ‰«ç æµ‹è¯•

## ğŸ†˜ å¸¸è§é—®é¢˜

### Q: æ•°æ®åº“æ¨é€å¤±è´¥ï¼Ÿ
```bash
# æ£€æŸ¥ç¯å¢ƒå˜é‡
cat .env.local

# æ£€æŸ¥æ•°æ®åº“è¿æ¥
psql $DATABASE_URL
```

### Q: ç§»åŠ¨ç«¯å¯åŠ¨å¤±è´¥ï¼Ÿ
```bash
# è¿›å…¥ç§»åŠ¨ç«¯ç›®å½•æ‰‹åŠ¨å¯åŠ¨
cd ../mobile
pnpm install
pnpm start
```

### Q: ç«¯å£è¢«å ç”¨ï¼Ÿ
```bash
# æŸ¥çœ‹ç«¯å£å ç”¨
lsof -i :3000

# æ€æ­»è¿›ç¨‹
kill -9 <PID>
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [é¡¹ç›®æ€»è§ˆ](../../README.md)
- [ç§»åŠ¨ç«¯è®¤è¯è®¾ç½®](../mobile/AUTH_SETUP.md)
- [éƒ¨ç½²æŒ‡å—](../../docs/deployment.md)

---

ğŸ’¡ **æç¤º**ï¼šå»ºè®®å°†å¸¸ç”¨å‘½ä»¤æ·»åŠ åˆ°ä½ çš„ shell åˆ«åä¸­ï¼Œæé«˜å¼€å‘æ•ˆç‡ï¼

